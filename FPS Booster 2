print("Script Successfully Executed")

local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TestService = game:GetService("TestService")

local TOGGLE_KEY = Enum.KeyCode.RightShift
local isLowGraphics = false
local Modified = {}
local BATCH_SIZE = 25

local ToDisable = {
	Textures = true,
	VisualEffects = true,
	Parts = true,
	Particles = true,
	Sky = true
}

local ToEnable = {
	FullBright = false
}

local function processObject(v)
	local info = {}

	if ToDisable.Parts and v:IsA("BasePart") then
		info.Material = v.Material
		info.Transparency = v.Transparency
		info.CastShadow = v.CastShadow

		v.Material = Enum.Material.SmoothPlastic
		v.Transparency = 0.8
		v.CastShadow = false
		Modified[v] = info

	elseif ToDisable.Particles and (v:IsA("ParticleEmitter") or v:IsA("Smoke") or v:IsA("Explosion") or v:IsA("Sparkles") or v:IsA("Fire")) then
		info.Enabled = v.Enabled
		v.Enabled = false
		Modified[v] = info

	elseif ToDisable.VisualEffects and (v:IsA("BloomEffect") or v:IsA("BlurEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("SunRaysEffect")) then
		info.Enabled = v.Enabled
		v.Enabled = false
		Modified[v] = info

	elseif ToDisable.Textures and (v:IsA("Decal") or v:IsA("Texture")) then
		info.Texture = v.Texture
		v.Texture = ""
		Modified[v] = info

	elseif ToDisable.Sky and v:IsA("Sky") then
		info.SkyboxBk = v.SkyboxBk
		info.SkyboxDn = v.SkyboxDn
		info.SkyboxFt = v.SkyboxFt
		info.SkyboxLf = v.SkyboxLf
		info.SkyboxRt = v.SkyboxRt
		info.SkyboxUp = v.SkyboxUp
		v.SkyboxBk = ""
		v.SkyboxDn = ""
		v.SkyboxFt = ""
		v.SkyboxLf = ""
		v.SkyboxRt = ""
		v.SkyboxUp = ""
		Modified[v] = info
	end
end

local function applyLowGraphicsAsync()
	local descendants = game:GetDescendants()
	local i = 1

	coroutine.wrap(function()
		while i <= #descendants do
			for j = 1, BATCH_SIZE do
				local v = descendants[i]
				if v then
					pcall(processObject, v)
				end
				i += 1
			end
			task.wait()
		end

		if ToEnable.FullBright then
			Lighting.FogColor = Color3.new(1, 1, 1)
			Lighting.FogStart = math.huge
			Lighting.FogEnd = math.huge
			Lighting.Ambient = Color3.new(1, 1, 1)
			Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
			Lighting.Brightness = 5
		end

		TestService:Message("[LowGraphics] ON - Done.")
	end)()
end

local function restoreGraphics()
	for obj, info in pairs(Modified) do
		if obj and obj.Parent then
			pcall(function()
				for prop, value in pairs(info) do
					obj[prop] = value
				end
			end)
		end
	end
	Modified = {}
	TestService:Message("[LowGraphics] OFF - Restored.")
end

UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == TOGGLE_KEY then
		isLowGraphics = not isLowGraphics
		if isLowGraphics then
			applyLowGraphicsAsync()
		else
			restoreGraphics()
		end
	end
end)
