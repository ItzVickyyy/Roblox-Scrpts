print("Script Successfully Executed")

local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local TOGGLE_KEY = Enum.KeyCode.RightShift
local localPlayer = Players.LocalPlayer
local Character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local TOGGLE_INTERVAL = 3 -- seconds
local SCAN_RADIUS = 20
local isEnabled = false
local lastScan = 0
local VisibleParts = {}

-- Hide all parts
local function hideAll()
	for _, part in pairs(Workspace:GetDescendants()) do
		if part:IsA("BasePart") then
			part.LocalTransparencyModifier = 1
		end
	end
end

-- Show only parts near you
local function showNearby()
	local region = Region3.new(
		HumanoidRootPart.Position - Vector3.new(SCAN_RADIUS, SCAN_RADIUS, SCAN_RADIUS),
		HumanoidRootPart.Position + Vector3.new(SCAN_RADIUS, SCAN_RADIUS, SCAN_RADIUS)
	)

	local parts = Workspace:FindPartsInRegion3(region, Character, math.huge)
	local shown = 0

	for _, part in ipairs(parts) do
		if part:IsA("BasePart") then
			part.LocalTransparencyModifier = 0
			VisibleParts[part] = true
			shown += 1
		end
	end
end

-- Reset visibility
local function resetVisibility()
	for part, _ in pairs(VisibleParts) do
		if part and part:IsA("BasePart") then
			part.LocalTransparencyModifier = 0
		end
	end
	VisibleParts = {}
end

local function enableEffect()
	hideAll()
	showNearby()
end

local function disableEffect()
	resetVisibility()
end

UIS.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == TOGGLE_KEY then
		isEnabled = not isEnabled
		if isEnabled then
			enableEffect()
		else
			disableEffect()
		end
	end
end)

-- Rescan only every few seconds while enabled
RunService.Stepped:Connect(function(_, dt)
	if not isEnabled then return end

	lastScan += dt
	if lastScan >= TOGGLE_INTERVAL then
		hideAll()
		resetVisibility()
		showNearby()
		lastScan = 0
	end
end)
